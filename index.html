<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="theme-color" content="#0f0c29">
    <link rel="manifest" href="manifest.json">
    <title>Core Trainer Pro</title>

        <style>
        :root {
            /* CYBER NEON PALET (Gebaseerd op de foto) */
            --bg-grad: linear-gradient(135deg, #0a0a14, #1a1a2e, #121224); /* Diepere, donkere achtergrond */
            --primary-grad: linear-gradient(to right, #00e5ff, #00aaff); /* Fel Cyaanblauw (Workouts) */
            --success-grad: linear-gradient(to right, #39ff14, #76ff03); /* Fel Limoengroen (Progress/Done) */
            --warning-grad: linear-gradient(to right, #ff00ff, #d500f9); /* Fel Neonroze/Magenta (Challenges/Rest) */
            
            /* Glassmorphism - Iets donkerder en glanzender */
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --blur: blur(16px);

            --text: #ffffff;
            --text-mute: #b0bec5; /* Iets koelere grijstint */
            --radius: 24px; /* Iets rondere hoeken zoals in de interface */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-grad);
            background-attachment: fixed; 
            color: var(--text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-font-smoothing: antialiased;
            user-select: none;
        }

        /* --- SCREENS --- */
        .screen {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 140px; 
            box-sizing: border-box;
        }
        .screen.active { display: flex; }

        /* --- HEADER & BUTTONS --- */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        h1 { font-size: 1.8rem; margin: 0; font-weight: 800; letter-spacing: 1px; text-shadow: 0 0 10px rgba(0, 229, 255, 0.5); }
        
        .btn-icon {
            background: rgba(255, 255, 255, 0.08);
            border: var(--glass-border);
            backdrop-filter: var(--blur);
            color: var(--text);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.2); /* Subtiele blauwe gloed */
        }
        .btn-icon:active { transform: scale(0.92); background: rgba(255,255,255,0.15); }

        /* --- DASHBOARD COMPONENTS --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        /* Voeg een subtiele neon rand toe aan panelen */
        .glass-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: var(--primary-grad);
            opacity: 0.5;
        }

        .week-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .week-title { font-weight: 800; font-size: 1.4rem; text-align: center; text-shadow: 0 0 8px rgba(0, 229, 255, 0.4); }
        .week-focus { font-size: 0.9rem; color: var(--text-mute); margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; text-align: center;}

        /* CHECKBOX VISUALIZER */
        .tracker-container { display: flex; justify-content: center; gap: 20px; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .check-circle {
            width: 45px; height: 45px; border-radius: 50%;
            background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.15);
            display: flex; align-items: center; justify-content: center;
            color: transparent; font-size: 1.4rem; transition: all 0.4s;
        }
        .check-circle.completed {
            background: var(--success-grad); border: none; color: #0a0a14; /* Donkere tekst op felle achtergrond */
            transform: scale(1.15); box-shadow: 0 0 25px #39ff14; /* Felle groene gloed */
        }

        /* PREVIEW LIST */
        .preview-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 1.1rem; }
        .preview-item:last-child { border-bottom: none; }
        .preview-item span:last-child { color: #00e5ff; font-weight: 800; text-shadow: 0 0 10px rgba(0, 229, 255, 0.6); }

        /* --- PLAYER --- */
        #playerScreen {
            background: rgba(10, 10, 20, 0.96); /* Donkerdere achtergrond */
            text-align: center; justify-content: center; align-items: center;
            padding-bottom: 20px;
            z-index: 50;
        }

        .timer-circle {
            width: 240px; height: 240px; border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.05); 
            display: flex; align-items: center; justify-content: center;
            margin: 30px auto; font-size: 5rem; font-weight: 900;
            font-variant-numeric: tabular-nums; transition: all 0.5s ease;
        }

        /* 5 BOLLETJES PROGRESSIE */
        .dots-container {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;
        }
        .progress-dot {
            width: 12px; height: 12px; border-radius: 50%;
            background: rgba(255,255,255,0.15); transition: all 0.3s;
        }
        .progress-dot.active { background: #00e5ff; box-shadow: 0 0 15px #00e5ff; transform: scale(1.3); }
        .progress-dot.done { background: #39ff14; box-shadow: 0 0 10px #39ff14; }

        .player-instruction { font-size: 1.8rem; font-weight: 800; margin-bottom: 10px; letter-spacing: 1px; text-shadow: 0 0 10px currentColor; }
        .player-detail { font-size: 1.2rem; color: var(--text-mute); text-transform: uppercase; letter-spacing: 2px;}

        /* STATES - Aangepast naar de nieuwe felle kleuren */
        .state-rest .timer-circle { box-shadow: 0 0 50px rgba(255, 0, 255, 0.6), inset 0 0 20px rgba(255, 0, 255, 0.2); color: #ff00ff; border-color: #ff00ff; } /* Neon Roze */
        .state-work .timer-circle { box-shadow: 0 0 60px rgba(57, 255, 20, 0.7), inset 0 0 30px rgba(57, 255, 20, 0.3); color: #39ff14; border-color: #39ff14; } /* Neon Groen */
        .state-manual .timer-circle { box-shadow: 0 0 50px rgba(0, 229, 255, 0.6), inset 0 0 20px rgba(0, 229, 255, 0.2); color: #00e5ff; border-style: dashed; border-color: #00e5ff; } /* Neon Blauw */

        /* --- STATS GRID --- */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .stat-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-num { font-size: 1.5rem; font-weight: bold; color: #00e5ff; display: block; text-shadow: 0 0 10px rgba(0, 229, 255, 0.4); }
        .stat-lbl { font-size: 0.8rem; color: var(--text-mute); }
        
        .grand-total { 
            background: var(--primary-grad); padding: 20px; border-radius: var(--radius); 
            text-align: center; margin-bottom: 20px; box-shadow: 0 0 40px rgba(0, 229, 255, 0.4);
            color: #0a0a14; /* Donkere tekst voor contrast */
        }

        /* --- POPUP MODAL --- */
        #modalOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(8px);
            z-index: 999; display: none;
            align-items: center; justify-content: center;
        }
        #modalOverlay.show { display: flex; }
        
        .modal-content {
            background: linear-gradient(145deg, #1a1a2e, #121224);
            border: 2px solid #39ff14; /* Groene neon rand */
            padding: 40px; border-radius: 30px; text-align: center;
            max-width: 80%; box-shadow: 0 0 60px rgba(57, 255, 20, 0.4);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* FLOATING ACTION BUTTON */
        .bottom-action-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; padding: 25px;
            background: linear-gradient(to top, #0a0a14 80%, rgba(10, 10, 20, 0));
            text-align: center; z-index: 100; box-sizing: border-box;
        }
        .big-btn {
            background: var(--primary-grad); color: #0a0a14; border: none;
            width: 100%; max-width: 500px; padding: 20px;
            font-size: 1.3rem; font-weight: 800; border-radius: 50px;
            cursor: pointer; box-shadow: 0 0 30px rgba(0, 229, 255, 0.6);
            text-transform: uppercase; letter-spacing: 2px;
        }
        .big-btn:active { transform: scale(0.98); }
        .action-btn { background: var(--success-grad); box-shadow: 0 0 30px rgba(57, 255, 20, 0.6); color: #0a0a14; }
        .close-modal-btn { background: var(--warning-grad); margin-top: 20px; padding: 15px 30px; border-radius: 30px; border:none; color:#0a0a14; font-weight:bold; cursor: pointer; box-shadow: 0 0 20px rgba(255, 0, 255, 0.5); }

    </style>


</head>
<body>

    <div id="dashboardScreen" class="screen active">
        <header>
            <h1>Core Trainer Pro</h1>
            <button class="btn-icon" onclick="showStats()">üìä</button>
        </header>

        <div class="glass-panel">
            <div class="week-nav">
                <button class="btn-icon" onclick="changeWeek(-1)">‚Üê</button>
                <div>
                    <div class="week-title" id="weekDisplay">Week 1</div>
                    <div class="week-focus">Focus: Fundering</div>
                </div>
                <button class="btn-icon" onclick="changeWeek(1)">‚Üí</button>
            </div>
            
            <div class="tracker-container" id="weekTracker">
                <div class="check-circle"></div>
                <div class="check-circle"></div>
                <div class="check-circle"></div>
            </div>
            <div style="text-align: center; margin-top: 10px; color: var(--text-mute); font-size: 0.8rem;">3 Sessies per week</div>
        </div>

        <div class="glass-panel">
            <h3 style="margin-top:0; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">Vandaag (3 Rondes)</h3>
            <div id="previewList"></div>
        </div>

        <div class="bottom-action-bar">
            <button class="big-btn" onclick="startWorkout()">START TRAINING ‚ñ∂</button>
        </div>
    </div>

    <div id="playerScreen" class="screen">
        <div style="position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.15); padding: 5px 15px; border-radius: 20px;">
            <span id="roundDisplay">Ronde 1 / 3</span>
        </div>
        
        <div style="width: 100%;">
            <div class="dots-container" id="progressDots">
                <div class="progress-dot"></div><div class="progress-dot"></div><div class="progress-dot"></div><div class="progress-dot"></div><div class="progress-dot"></div>
            </div>

            <div class="player-instruction" id="exName">Klaarmaken...</div>
            <div class="player-detail" id="exDetail">Start in</div>
            
            <div class="timer-circle" id="timerDisplay">8</div>
        </div>

        <div style="width: 100%; display: flex; flex-direction: column; align-items: center; margin-top: 30px;">
            <button id="actionBtn" class="big-btn action-btn" onclick="handleAction()" style="display:none; width:80%;">VOLGENDE</button>
            <button onclick="quitWorkout()" style="background:none; border:none; color:var(--text-mute); margin-top:20px; text-decoration:underline;">Afbreken</button>
        </div>
    </div>

    <div id="statsScreen" class="screen" style="background: rgba(15, 12, 41, 0.98); z-index: 100;">
        <header>
            <h1>Statistieken</h1>
            <button class="btn-icon" onclick="closeStats()">‚úï</button>
        </header>
        
        <div style="overflow-y: auto; padding-bottom: 20px;" id="statsContent">
            </div>
    </div>

    <div id="modalOverlay">
        <div class="modal-content">
            <div style="font-size: 4rem; margin-bottom: 10px;">üèÜ</div>
            <h2 style="font-size: 2rem; margin: 0; background: var(--success-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">GEFELICITEERD!</h2>
            <p style="color: var(--text-mute); font-size: 1.2rem;">Je training zit erop. Goed gewerkt!</p>
            <button class="close-modal-btn" onclick="closeModal()">SLUITEN & OPSLAAN</button>
        </div>
    </div>

<script>
    // --- AUDIO CONTEXT (Web Audio API) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playBeep(freq = 440, duration = 0.1, type = 'sine') {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.value = freq;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
        osc.stop(audioCtx.currentTime + duration);
    }

    // --- WAKE LOCK ---
    let wakeLock = null;
    async function requestWakeLock() {
        try { wakeLock = await navigator.wakeLock.request('screen'); } catch (err) { console.log('Wake Lock error:', err); }
    }
    async function releaseWakeLock() {
        if (wakeLock !== null) { await wakeLock.release(); wakeLock = null; }
    }

    // --- DATA ---
    const exercises = [
        { id: 'plank', name: 'De Plank', type: 'time', unit: 'sec' },
        { id: 'bicycle', name: 'Bicycle Crunches', type: 'reps', unit: 'reps' },
        { id: 'legraise', name: 'Lying Leg Raises', type: 'reps', unit: 'reps' },
        { id: 'mountain', name: 'Mountain Climbers', type: 'time', unit: 'sec' },
        { id: 'twists', name: 'Russian Twists', type: 'reps', unit: 'reps' }
    ];

    const weeklyProgression = {
        1: { plank: 30, bicycle: 20, legraise: 10, mountain: 30, twists: 20 },
        2: { plank: 35, bicycle: 24, legraise: 12, mountain: 30, twists: 24 },
        3: { plank: 40, bicycle: 30, legraise: 14, mountain: 35, twists: 30 },
        4: { plank: 45, bicycle: 36, legraise: 15, mountain: 40, twists: 36 },
        5: { plank: 50, bicycle: 40, legraise: 15, mountain: 45, twists: 40 },
        6: { plank: 60, bicycle: 44, legraise: 18, mountain: 50, twists: 44 },
        7: { plank: 75, bicycle: 50, legraise: 20, mountain: 60, twists: 50 },
        8: { plank: 90, bicycle: 60, legraise: 20, mountain: 60, twists: 60 }
    };

    let state = {
        currentWeek: 1,
        history: [], 
        isActive: false,
        round: 1,
        exIndex: 0,
        phase: 'idle', 
        timeLeft: 0,
        timerInterval: null
    };

    const TOTAL_ROUNDS = 3;
    const PREP_TIME = 8;
    const ROUND_REST = 30;

    // --- INIT ---
    window.onload = function() {
        const saved = localStorage.getItem('abs_pro_v3'); // v3 voor nieuwe structuur
        if(saved) {
            const parsed = JSON.parse(saved);
            state.currentWeek = parsed.currentWeek || 1;
            state.history = parsed.history || [];
        }
        renderDashboard();
    };

    function saveData() {
        localStorage.setItem('abs_pro_v3', JSON.stringify({
            currentWeek: state.currentWeek,
            history: state.history
        }));
    }

    // --- DASHBOARD ---
    function renderDashboard() {
        document.getElementById('weekDisplay').innerText = `Week ${state.currentWeek}`;
        
        const targets = weeklyProgression[state.currentWeek];
        const list = document.getElementById('previewList');
        list.innerHTML = '';
        exercises.forEach(ex => {
            const val = targets[ex.id];
            list.innerHTML += `<div class="preview-item"><span>${ex.name}</span><span>${val} ${ex.unit}</span></div>`;
        });

        const workoutsThisWeek = state.history.filter(h => h.week === state.currentWeek).length;
        const tracker = document.getElementById('weekTracker');
        tracker.innerHTML = '';
        for(let i=0; i<3; i++) {
            tracker.innerHTML += `<div class="check-circle ${i < workoutsThisWeek ? 'completed' : ''}">${i < workoutsThisWeek ? '‚úì' : ''}</div>`;
        }
    }

    function changeWeek(dir) {
        if((state.currentWeek === 1 && dir === -1) || (state.currentWeek === 8 && dir === 1)) return;
        state.currentWeek += dir;
        renderDashboard();
    }

    // --- PLAYER LOGIC ---
    function startWorkout() {
        requestWakeLock();
        // Init Audio Context op user click
        if(audioCtx.state === 'suspended') audioCtx.resume();

        state.isActive = true;
        state.round = 1;
        state.exIndex = 0;
        
        document.getElementById('dashboardScreen').classList.remove('active');
        document.getElementById('playerScreen').classList.add('active');
        startPrep();
    }

    function updateDots() {
        const container = document.getElementById('progressDots');
        container.innerHTML = '';
        // 5 Dots voor de 5 oefeningen
        for(let i=0; i<exercises.length; i++) {
            let className = 'progress-dot';
            if (i < state.exIndex) className += ' done';
            if (i === state.exIndex) className += ' active';
            container.innerHTML += `<div class="${className}"></div>`;
        }
    }

    function startPrep() {
        if(state.timerInterval) clearInterval(state.timerInterval);
        state.phase = 'prep';
        state.timeLeft = PREP_TIME;
        
        updateDots();
        const currentEx = exercises[state.exIndex];
        
        document.getElementById('playerScreen').className = 'screen active state-rest';
        document.getElementById('roundDisplay').innerText = `Ronde ${state.round} / ${TOTAL_ROUNDS}`;
        document.getElementById('exName').innerText = "Rust / Wissel";
        document.getElementById('exDetail').innerText = "Volgende: " + currentEx.name;
        document.getElementById('actionBtn').style.display = 'none';
        
        updateTimerDisplay();

        state.timerInterval = setInterval(() => {
            state.timeLeft--;
            updateTimerDisplay();
            
            // Beep laatste 3 sec van rust
            if(state.timeLeft > 0 && state.timeLeft <= 3) playBeep(600, 0.05);

            if(state.timeLeft <= 0) startExercise();
        }, 1000);
    }

    function startExercise() {
        if(state.timerInterval) clearInterval(state.timerInterval);
        const currentEx = exercises[state.exIndex];
        const targets = weeklyProgression[state.currentWeek];
        const targetVal = targets[currentEx.id];

        document.getElementById('exName').innerText = currentEx.name;
        updateDots();
        
        if (currentEx.type === 'time') {
            state.phase = 'work';
            state.timeLeft = targetVal;
            document.getElementById('playerScreen').className = 'screen active state-work';
            document.getElementById('exDetail').innerText = "HOU VOL!";
            document.getElementById('actionBtn').style.display = 'none';
            
            updateTimerDisplay();
            
            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                updateTimerDisplay();
                // Beep laatste 5 sec
                if(state.timeLeft > 0 && state.timeLeft <= 5) playBeep(880, 0.1);
                
                if(state.timeLeft <= 0) {
                    playBeep(1200, 0.3); // Finish beep
                    nextStep();
                }
            }, 1000);
        } else {
            state.phase = 'manual';
            document.getElementById('playerScreen').className = 'screen active state-manual';
            document.getElementById('exDetail').innerText = `Doe ${targetVal} herhalingen`;
            document.getElementById('timerDisplay').innerText = targetVal;
            document.getElementById('actionBtn').style.display = 'block';
        }
    }

    function handleAction() {
        if(state.phase === 'manual') nextStep();
    }

    function nextStep() {
        if(state.timerInterval) clearInterval(s
