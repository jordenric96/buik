<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Core Trainer Pro</title>
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --white: #ffffff;
            --radius: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Voorkom scrollen tijdens workout */
        }

        /* --- SCREENS --- */
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .screen.active {
            display: flex;
        }

        /* --- DASHBOARD --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        h1 { font-size: 1.5rem; margin: 0; }
        
        .btn-icon {
            background: var(--white);
            border: 1px solid #e2e8f0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .week-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--white);
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }

        .big-start-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: var(--radius);
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            margin-top: auto; /* Duw naar beneden */
        }

        .stats-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--white);
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
        }
        .stat-val { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 0.8rem; color: #64748b; }

        /* --- PLAYER --- */
        #playerScreen {
            background: var(--dark);
            color: white;
            text-align: center;
            justify-content: center;
        }

        .round-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.1);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .timer-circle {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            border: 8px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            font-size: 4rem;
            font-weight: 900;
            font-variant-numeric: tabular-nums;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.2);
            transition: border-color 0.3s;
        }

        .player-instruction {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .player-detail {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 40px;
        }

        .action-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            width: 80%;
            max-width: 300px;
        }
        
        .stop-btn {
            background: transparent;
            color: #ef4444;
            border: none;
            margin-top: 20px;
            cursor: pointer;
            text-decoration: underline;
        }

        /* States Colors */
        .state-rest .timer-circle { border-color: var(--warning); color: var(--warning); }
        .state-work .timer-circle { border-color: var(--success); color: var(--success); }
        .state-manual .timer-circle { border-color: var(--primary); color: white; border-style: dashed; }

        /* --- STATS MODAL --- */
        .chart-bar {
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        .chart-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 1s ease;
        }
        .history-list {
            margin-top: 20px;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

    </style>
</head>
<body>

    <div id="dashboardScreen" class="screen active">
        <header>
            <h1>Mijn Schema</h1>
            <button class="btn-icon" onclick="showStats()">üìä</button>
        </header>

        <div class="week-selector">
            <button class="btn-icon" onclick="changeWeek(-1)">‚Üê</button>
            <div style="text-align: center;">
                <div style="font-weight: bold; font-size: 1.1rem;" id="weekDisplay">Week 1</div>
                <div style="font-size: 0.8rem; color: #64748b;">Focus: Fundering</div>
            </div>
            <button class="btn-icon" onclick="changeWeek(1)">‚Üí</button>
        </div>

        <div class="stats-summary">
            <div class="stat-card">
                <div class="stat-val" id="totalWorkouts">0</div>
                <div class="stat-label">Workouts Voltooid</div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="currentStreak">0</div>
                <div class="stat-label">Dagen Reeks</div>
            </div>
        </div>

        <div style="background: white; padding: 20px; border-radius: var(--radius); margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Circuit Vandaag</h3>
            <ul style="padding-left: 20px; color: #475569; margin-bottom: 0;" id="previewList">
                </ul>
        </div>

        <button class="big-start-btn" onclick="startWorkout()">START WORKOUT ‚ñ∂</button>
    </div>

    <div id="playerScreen" class="screen">
        <div class="round-indicator" id="roundDisplay">Ronde 1 / 3</div>
        
        <div style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <div class="player-instruction" id="exName">Klaarmaken...</div>
            <div class="player-detail" id="exDetail">Start in</div>
            
            <div class="timer-circle" id="timerDisplay">8</div>
        </div>

        <div style="padding-bottom: 40px; width: 100%; display: flex; flex-direction: column; align-items: center;">
            <button id="actionBtn" class="action-btn" onclick="handleAction()">Start</button>
            <button class="stop-btn" onclick="quitWorkout()">Stoppen</button>
        </div>
    </div>

    <div id="statsScreen" class="screen" style="background: white;">
        <header>
            <h1>Statistieken</h1>
            <button class="btn-icon" onclick="closeStats()">‚úï</button>
        </header>
        <div id="statsContent">
            </div>
    </div>

<script>
    // --- DATA ---
    const exercises = [
        { id: 'plank', name: 'De Plank', type: 'time' },
        { id: 'bicycle', name: 'Bicycle Crunches', type: 'reps' },
        { id: 'legraise', name: 'Lying Leg Raises', type: 'reps' },
        { id: 'mountain', name: 'Mountain Climbers', type: 'time' },
        { id: 'twists', name: 'Russian Twists', type: 'reps' }
    ];

    const weeklyProgression = {
        1: { plank: 30, bicycle: 20, legraise: 10, mountain: 30, twists: 20 },
        2: { plank: 35, bicycle: 24, legraise: 12, mountain: 30, twists: 24 },
        3: { plank: 40, bicycle: 30, legraise: 14, mountain: 35, twists: 30 },
        4: { plank: 45, bicycle: 36, legraise: 15, mountain: 40, twists: 36 },
        5: { plank: 50, bicycle: 40, legraise: 15, mountain: 45, twists: 40 },
        6: { plank: 60, bicycle: 44, legraise: 18, mountain: 50, twists: 44 },
        7: { plank: 75, bicycle: 50, legraise: 20, mountain: 60, twists: 50 },
        8: { plank: 90, bicycle: 60, legraise: 20, mountain: 60, twists: 60 }
    };

    // --- STATE ---
    let state = {
        currentWeek: 1,
        history: [], // { date: '2023-10-01', week: 1 }
        
        // Player state
        isActive: false,
        round: 1,
        exIndex: 0,
        phase: 'idle', // idle, prep, work, manual
        timeLeft: 0,
        timerInterval: null
    };

    const TOTAL_ROUNDS = 3;
    const PREP_TIME = 8;

    // --- INIT ---
    window.onload = function() {
        const saved = localStorage.getItem('abs_pro_data');
        if(saved) {
            const parsed = JSON.parse(saved);
            state.currentWeek = parsed.currentWeek || 1;
            state.history = parsed.history || [];
        }
        renderDashboard();
    };

    function saveData() {
        localStorage.setItem('abs_pro_data', JSON.stringify({
            currentWeek: state.currentWeek,
            history: state.history
        }));
    }

    // --- DASHBOARD FUNCTIONS ---
    function renderDashboard() {
        document.getElementById('weekDisplay').innerText = `Week ${state.currentWeek}`;
        document.getElementById('totalWorkouts').innerText = state.history.length;
        
        // Preview list
        const targets = weeklyProgression[state.currentWeek];
        const list = document.getElementById('previewList');
        list.innerHTML = '';
        exercises.forEach(ex => {
            const val = targets[ex.id];
            const unit = ex.type === 'time' ? 'sec' : 'reps';
            list.innerHTML += `<li>${ex.name}: <strong>${val} ${unit}</strong></li>`;
        });
    }

    function changeWeek(dir) {
        if((state.currentWeek === 1 && dir === -1) || (state.currentWeek === 8 && dir === 1)) return;
        state.currentWeek += dir;
        saveData();
        renderDashboard();
    }

    function showStats() {
        document.getElementById('dashboardScreen').classList.remove('active');
        document.getElementById('statsScreen').classList.add('active');
        renderStats();
    }

    function closeStats() {
        document.getElementById('statsScreen').classList.remove('active');
        document.getElementById('dashboardScreen').classList.add('active');
    }

    // --- PLAYER LOGIC ---
    function startWorkout() {
        state.isActive = true;
        state.round = 1;
        state.exIndex = 0;
        
        document.getElementById('dashboardScreen').classList.remove('active');
        document.getElementById('playerScreen').classList.add('active');
        
        startPrep();
    }

    function quitWorkout() {
        if(confirm("Stoppen met de workout?")) {
            stopTimer();
            state.isActive = false;
            document.getElementById('playerScreen').classList.remove('active');
            document.getElementById('dashboardScreen').classList.add('active');
        }
    }

    function stopTimer() {
        if(state.timerInterval) clearInterval(state.timerInterval);
    }

    // PHASE 1: PREP (8 seconden tussendoor)
    function startPrep() {
        stopTimer();
        state.phase = 'prep';
        state.timeLeft = PREP_TIME;
        
        // UI Updates
        const currentEx = exercises[state.exIndex];
        document.getElementById('playerScreen').className = 'screen active state-rest';
        document.getElementById('roundDisplay').innerText = `Ronde ${state.round} / ${TOTAL_ROUNDS}`;
        document.getElementById('exName').innerText = "Volgende: " + currentEx.name;
        document.getElementById('exDetail').innerText = "Maak je klaar...";
        document.getElementById('actionBtn').style.display = 'none'; // Verberg knop tijdens rust
        
        updateTimerDisplay();

        state.timerInterval = setInterval(() => {
            state.timeLeft--;
            updateTimerDisplay();
            if(state.timeLeft <= 0) {
                startExercise();
            }
        }, 1000);
    }

    // PHASE 2: EXERCISE
    function startExercise() {
        stopTimer();
        const currentEx = exercises[state.exIndex];
        const targets = weeklyProgression[state.currentWeek];
        const targetVal = targets[currentEx.id];

        // UI Updates
        document.getElementById('exName').innerText = currentEx.name;
        
        if (currentEx.type === 'time') {
            // TIME BASED
            state.phase = 'work';
            state.timeLeft = targetVal;
            document.getElementById('playerScreen').className = 'screen active state-work';
            document.getElementById('exDetail').innerText = "HOU VOL!";
            document.getElementById('actionBtn').style.display = 'none';
            
            updateTimerDisplay();
            
            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                updateTimerDisplay();
                if(state.timeLeft <= 0) {
                    nextStep();
                }
            }, 1000);

        } else {
            // REP BASED (Manual)
            state.phase = 'manual';
            document.getElementById('playerScreen').className = 'screen active state-manual';
            document.getElementById('exDetail').innerText = `Doe ${targetVal} herhalingen`;
            document.getElementById('timerDisplay').innerText = targetVal;
            document.getElementById('actionBtn').style.display = 'block';
            document.getElementById('actionBtn').innerText = "KLAAR";
        }
    }

    // Handler voor de knop
    function handleAction() {
        if(state.phase === 'manual') {
            nextStep();
        }
    }

    function nextStep() {
        stopTimer();
        
        // Check if round is done
        if (state.exIndex < exercises.length - 1) {
            // Next exercise same round
            state.exIndex++;
            startPrep();
        } else {
            // End of round
            if (state.round < TOTAL_ROUNDS) {
                state.round++;
                state.exIndex = 0;
                // Lange rust tussen rondes? Laten we 30s doen
                state.timeLeft = 30; // Override prep time
                state.phase = 'prep';
                document.getElementById('playerScreen').className = 'screen active state-rest';
                document.getElementById('exName').innerText = "Ronde Pauze";
                document.getElementById('exDetail').innerText = "Even op adem komen";
                document.getElementById('actionBtn').style.display = 'none';
                
                state.timerInterval = setInterval(() => {
                    state.timeLeft--;
                    updateTimerDisplay();
                    if(state.timeLeft <= 0) startExercise(); // Start direct eerste oefening ronde 2
                }, 1000);

            } else {
                finishWorkout();
            }
        }
    }

    function updateTimerDisplay() {
        document.getElementById('timerDisplay').innerText = state.timeLeft;
    }

    function finishWorkout() {
        stopTimer();
        state.history.push({ date: new Date().toISOString(), week: state.currentWeek });
        saveData();
        alert("GEFELICITEERD! Training voltooid.");
        document.getElementById('playerScreen').classList.remove('active');
        document.getElementById('dashboardScreen').classList.add('active');
        renderDashboard();
    }

    // --- STATS LOGIC ---
    function renderStats() {
        const container = document.getElementById('statsContent');
        container.innerHTML = '';

        if(state.history.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#94a3b8;">Nog geen trainingen voltooid.</p>';
            return;
        }

        // Groepeer per week
        const weeksCompleted = {};
        state.history.forEach(h => {
            weeksCompleted[h.week] = (weeksCompleted[h.week] || 0) + 1;
        });

        let html = '<h3>Aantal Trainingen per Week</h3>';
        
        for(let i=1; i<=8; i++) {
            const count = weeksCompleted[i] || 0;
            // Max 3 trainingen per week is 100%
            const pct = Math.min(100, (count / 3) * 100);
            const color = count >= 3 ? 'var(--success)' : 'var(--primary)';
            
            html += `
                <div style="margin-bottom: 10px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
                        <span>Week ${i}</span>
                        <span>${count}/3</span>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-fill" style="width: ${pct}%; background: ${color}"></div>
                    </div>
                </div>
            `;
        }

        html += '<h3 style="margin-top:30px;">Recente Activiteit</h3>';
        state.history.slice().reverse().slice(0, 5).forEach(h => {
            const d = new Date(h.date);
            html += `
                <div class="history-item">
                    <span>${d.toLocaleDateString('nl-NL')}</span>
                    <strong>Week ${h.week}</strong>
                </div>
            `;
        });

        container.innerHTML += html;
    }
</script>

</body>
</html>
